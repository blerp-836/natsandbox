[SOURCE]
SOURCE_TYPE=metastore
SOURCE_PATH=dbfs:/mnt/%(STORAGE_ACCOUNT_NAME)s/delta/integration/i18nRegions/incoming
SOURCE_SCHEMA=ytb_analytics_int
SOURCE_TABLE=int_i18n_regions
SOURCE_QUERY='SELECT distinct(*) FROM {0}.{1} where load_date_time in (select max(load_date_time) from {0}.{1})'
SOURCE_PK=['src_country_pk',['dim_regions_id','dim_extract_date']]
DELTA_COL=load_date_time
STORAGE_ACCOUNT_NAME = natmsdnadlsdatabricks
FILE_FORMAT=delta
TEMP_PATH=dbfs:/mnt/%(STORAGE_ACCOUNT_NAME)s/delta/integration/i18nRegions/temp

[DEST]
STORAGE_ACCOUNT_NAME = natmsdnadlsdatabricks
FEATURES = '''select countryCode,id, gl as iso_country_code,name as region_name,load_date as extractDate from tempview'''
DEST_TYPE=dataframe
DEST_SCHEMA=ytb_analytics_pst
DEST_TABLE=pst_i18n_regions
DEST_QUERY='SELECT * FROM {0}.{1}'
INSERT_DICT={'src_country_pk':'source.src_country_pk',
              'dim_regions_id':'source.dim_regions_id',
              'dim_iso_country_code':'source.dim_iso_country_code',
              'dim_region_name':'source.dim_region_name',
              'dim_extract_date':'source.dim_extract_date',
              'modified_ts':'source.modified_ts',
              'countryCode':'source.countryCode',
              'load_date':'source.load_date'}
UPDATE_DICT={'dim_region_name':'source.dim_region_name','modified_ts':'source.modified_ts',
            'dim_iso_country_code':'source.dim_iso_country_code'}
UPSERT_STATEMENT=''
UPSERT_STATEMENT_SAMPLE='''MERGE INTO ytb_analytics_pst.pst_i18n_regions
                        USING df_source_view
                        ON ytb_analytics_pst.pst_i18n_regions.src_country_pk=df_source_view.src_country_pk
                        when matched then
                        update set 
                        dim_region_name=df_source_view.dim_region_name
                        when not matched then insert(
                        src_country_pk,
                        dim_regions_id,
                        dim_iso_country_code,
                        dim_region_name,
                        dim_extract_date,
                        modified_ts,
                        countryCode,
                        load_date)
                        VALUES(df_source_view.src_country_pk,
                        df_source_view.dim_regions_id,
                        df_source_view.dim_iso_country_code,
                        df_source_view.dim_region_name,
                        df_source_view.dim_extract_date,
                        df_source_view.modified_ts,
                        df_source_view.countryCode,
                        df_source_view.load_date
                        )'''
PART_KEYS=['countryCode','modified_ts']
DEDUPLICATION=True
DELTA_COL=modified_ts
DEST_PATH=dbfs:/mnt/%(STORAGE_ACCOUNT_NAME)s/delta/presentation/i18nRegions/incoming
MODIFIED_TS=modified_ts
DEST_PK=src_country_pk
UPDATE_COND='''(dest.dim_region_name!=source.dim_region_name) OR (dest.dim_iso_country_code!= source.dim_iso_country_code)'''
DEL_COND='src_country_pk is not NULL'

[MAPPING]
BLOB_ACCOUNT_NAME=deployblob123
CONTAINER_NAME=deploy
PATH=/dbfs/mnt/deployblob123/deploy/jobs/ytb_i18nRegions/mapping/
FK_JOIN=
FOREIGN_QUERY=
SCD_TYPE=1

