[SOURCE]
SOURCE_TYPE=metastore
SOURCE_PATH=dbfs:/mnt/%(STORAGE_ACCOUNT_NAME)s/delta/integration/i18nRegions/incoming
SOURCE_SCHEMA=ytb_analytics_int
SOURCE_TABLE=int_i18n_regions
SOURCE_QUERY='SELECT * FROM {0}.{1}'
SOURCE_PK=['src_country_pk',['dim_regions_id','load_date']]
DELTA_COL=load_date_time
STORAGE_ACCOUNT_NAME = natmsdnadlsdatabricks
FILE_FORMAT='delta'
TEMP_PATH=dbfs:/mnt/%(STORAGE_ACCOUNT_NAME)s/delta/integration/i18nRegions/temp
SOURCE_TS=load_date_time

[DEST]
STORAGE_ACCOUNT_NAME = natmsdnadlsdatabricks
FEATURES = '''select countryCode,id, gl as iso_country_code,name as region_name,load_date as extractDate from tempview'''
DEST_TYPE=dataframe
DEST_SCHEMA=ytb_analytics_pst
DEST_TABLE=pst_i18n_regions
DEST_QUERY='SELECT * FROM {0}.{1}'
INSERT_DICT={'src_country_pk':'staged_updates.src_country_pk',
              'dim_regions_id':'staged_updates.dim_regions_id',
              'dim_iso_country_code':'staged_updates.dim_iso_country_code',
              'dim_region_name':'staged_updates.dim_region_name',
              'dim_extract_date':'staged_updates.dim_extract_date',
              'modified_ts':'staged_updates.modified_ts',
              'countryCode':'staged_updates.countryCode',
              'load_date':'staged_updates.load_date'}
UPDATE_DICT={'dim_region_name':'staged_updates.dim_region_name','modified_ts':'staged_updates.modified_ts'}
UPSERT_STATEMENT=''
UPSERT_STATEMENT_SAMPLE='''MERGE INTO ytb_analytics_pst.pst_i18n_regions
                        USING df_source_view
                        ON ytb_analytics_pst.pst_i18n_regions.src_country_pk=df_source_view.src_country_pk
                        when matched then
                        update set 
                        dim_region_name=df_source_view.dim_region_name
                        when not matched then insert(
                        src_country_pk,
                        dim_regions_id,
                        dim_iso_country_code,
                        dim_region_name,
                        dim_extract_date,
                        modified_ts,
                        countryCode,
                        load_date)
                        VALUES(df_source_view.src_country_pk,
                        df_source_view.dim_regions_id,
                        df_source_view.dim_iso_country_code,
                        df_source_view.dim_region_name,
                        df_source_view.dim_extract_date,
                        df_source_view.modified_ts,
                        df_source_view.countryCode,
                        df_source_view.load_date
                        )'''
PART_KEYS=['countryCode','modified_ts']
DEDUPLICATION=True
DELTA_COL=modified_ts
DEST_PATH=dbfs:/mnt/%(STORAGE_ACCOUNT_NAME)s/delta/presentation/i18nRegions/incoming
MODIFIED_TS=modified_ts
DEST_PK=src_country_pk
SCD2_INSERT_COND='''dest.dim_region_name!=source.dim_region_name'''
UPDATE_COND='''dest.dim_region_name!=staged_updates.dim_region_name'''

[MAPPING]
BLOB_ACCOUNT_NAME=deployblob123
CONTAINER_NAME=deploy/
FK_JOIN={'ytb_analytics_int.int_i18n_regions_scd2_test':[['region_name'],['region_name']]}
FOREIGN_QUERY={'ytb_analytics_int.int_i18n_regions_scd2_test':'select region_name,iso_country_code,eff_start_dt,eff_end_dt from ytb_analytics_int.int_i18n_regions_scd2_test'}
SCD_TYPE=2
EFF_START_DT=eff_start_dt
EFF_END_DT=eff_end_dt
PATH=jobs/ytb_i18nRegions/mapping/
